{{ define "main" }}
<main>
  <section class="p-strip--suru">
    <div class="row">
      <h2>{{.Title}}</h2>
      {{ with .OutputFormats.Get "Calendar" -}}
      <a rel="{{ .Rel }}" type="{{ .MediaType.Type }}" href="{{ .Permalink | safeURL }}"><button>{{ i18n
          "ical_subscribe" }}</button></a>
      <a rel="{{ .Rel }}" type="{{ .MediaType.Type }}" href="{{ .RelPermalink | safeURL }}"><button>{{ i18n "ical_add"
          }}</button></a>
      {{- end }}
    </div>
  </section>
  <section class="p-strip">
    <div class="row">
      <div id="schedule_container"></div>
    </div>
  </section>
</main>
{{ $pages := .Site.Pages }}
{{ range .Site.Home.Translations }}
{{ $pages = $pages | lang.Merge .Site.Pages }}
{{ end }}
{{ $pages = (where $pages "Section" "sessions") }}
<script>
  function convertTimeToLocalTZ(date) {
    let toConvert = new Date(date);
    let currentTZ = new window.Intl.DateTimeFormat().resolvedOptions().timeZone;
    return toConvert.toLocaleTimeString('en-US', { hour12: false, timeZone: currentTZ });
  }

  document.addEventListener('DOMContentLoaded', function () {

    let ec = new EventCalendar(document.getElementById('schedule_container'), {
      allDaySlot: false,
      slotDuration: '00:05:00',
      height: '90vh',
      scrollTime: convertTimeToLocalTZ('{{ .Site.Params.timetable.timeStart }}'),
      nowIndicator: true,
      resources: [
        { id: 1, title: 'Intl room' },
        { id: 2, title: 'Workshop' },
        { id: 2, title: 'BoF' }
      ],
      view: 'resourceTimeGridDay',
      views: {
        resourceTimeGridDay: { pointer: true }
      },
      eventClick: function (info) {
        window.location = info.event.extendedProps.url;
      },
      events: [
        {{ range $pages }}
        {{ if .Params.speakers }}
          {
      title: '{{.Title}} - {{range .Params.speakers}}{{.name}};{{end}}',
      start: new Date('{{dateFormat "2006-01-02T15:04:05-07:00" .Date.UTC}}'),
      end: new Date('{{dateFormat "2006-01-02T15:04:05-07:00" (time .Params.end).UTC}}'),
      // url: '{{.RelPermalink}}',
      resourceId: {{.Params.room }},
      extendedProps: {url: '{{.RelPermalink}}'}
          },
    {{ end }}
    {{ end }}
    ]
});
  });


</script>

{{ end }}